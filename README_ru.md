# foatto.CRUD

CRUD - это платформа для быстрого создания информационных систем. [[English version](README.md)]

## Описание возможностей платформы

Клиентская часть платформы поддерживает следующие виды отображаемой информации:
  - табличный вид;
  - формы просмотра и редактирования;
  - графики измерений величин;
  - картография с векторными пользовательскими элементами и возможностями их интерактивного изменения;
  - SCADA-подобное отображение состояния объектов; 

Серверная часть платформы предлагает следующие возможности:
  - декларативное задание атрибутов хранения, отображения и взаимосвязей прикладных модулей, используя внутренний ORM;
  - поддержка основных диалектов SQL СУБД;
  - асинхронная master-to-master репликация транзакций с поддержкой неодинаковых SQL-диалектов на серверах и возможностью проксирования реплик между серверами через узел-посредник;
  - система прав доступа, основанная на комбинации ролей (положительных и отрицательных) и положения пользователя в структуре предприятия;
  - отдельный сервер приёма телематических данных (и отправки команд) с устройств IoT (технологические/телематические приборы и контроллеры) по различным бинарным и текстовым протоколам, использующим TCP как транспортный протокол; 

Планируемые возможности:
  - поддержка отображения видео-информации (с привязкой к графикам измерений и элементам картографии);
  - добавление новых клиентских платформ (android и desktop версий) на технологиях JetBrains Compose Multiplatform; 

Устаревшие и уже удалённые функции платформы:
  - desktop-клиент на Swing;
  - desktop-клиент на JavaFX;
  - древний android-клиент на Java эпохи "Android 4.x";
  - web-клиент на технологии Kotlin/JS (legacy backend) + Vue.js wrapper; 

В настоящее время на данной платформе реализованы четыре прикладных проекта, находящиеся в коммерческой эксплуатации:
  - [Система контроля транспорта и технологических объектов "Пульсар"](https://pulsar.report):
    - контроль транспорта - пробеги, местонахождение в геозонах и т.п.;
    - работа бурового оборудования;
    - установок генерации электроэнергии;
    - контроля уровня и расхода топлива в баках и цистернах;

    В эксплуатации с 2006 года.
  - [Система контроля исполнения поручений](http://crm.magnol.ru).

    В эксплуатации с 2003 года.
  - Система розничной торговли и складского учёта:
    - поддержка операций розничной торговли; 
    - поддержка онлайн-касс и чековых принтеров ATOL;
    - поддержка системы маркировки товаров;
    - поддержка складского учёта;

    В эксплуатации с 2014 года.
  - Система контроля установок депарафинизации скважин "УДС-Техно"

## Описание структуры проекта

Весь исходный код платформы и рабочих проектов оформлен в виде модулей основого проекта    

### core

Базовый common-модуль, содержит код, общий для клиентской и серверной частей:
  - Request-классы;
  - Response-классы;
  - Data/Info/Config-классы;
  - общие константы, функции и интерфейсы;

JVM-часть core-модуля содержит классы, могущие пригодиться для Desktop/Android-версии.

### core_compose

Базовый compose-модуль, содержащий общие классы, функции и константы для compose-модулей для конкретной платформы (Android, Desktop, Web).

### core_compose_web

Общий для всех прикладных проектов модуль веб-клиента, использующего комбинацию технологий Kotlin/JS и JetBrains Compose for Web:
  - Composable функции для отображения интерактивных страниц;
  - Kotlin/JS для реализации реакций на события;
  - CSS Grid & Flex для отображения табличных форм и форм редактирования;
  - SVG для отображения графиков измерений, картографии и SCADA-подобного отображения состояния объектов;
  - автоматическое переключение между двумя вариантами разметки (для узких экранов мобильных устройств и широких экранов настольных систем);
  - поддержка сенсорных экранов;
  - поддержка различной плотности точек (актуально для графиков измерений и картографии);
  - возможность изменения параметров дизайна для брендирования прикладных проектов; 

### core_server

Содержит общие серверные компоненты для всех прикладных проектов, не зависящие от конкретной прикладной области и от реализации конкретного веб-контейнера (Spring Boot MVC/WebFlux, Ktor и т.п.).:
  - Column/Data-классы для реализации внутреннего ORM;
  - базовые model & controller классы для декларативного определения и организации работы табличных форм и форм редактирования;
  - модули для базовой подготовки данных для отображения на графиках измерений;
  - модули для базовой подготовки данных для отображения картографии, пользовательских векторных данных на ней;
  - модули для базовой подготовки данных для схематичного отображения состояния объектов;
  - системные классы для организации работы любого прикладного приложения:
    - конфигурация модулей системы;
    - аккаунты пользователей;
    - роли пользователей;
  - интерфейсы для доступа к функциям внешнего веб-контейнера (Spring Boot MVC/WebFlux, Ktor и т.п.);
  - расширения стандартных JDBC-классов для обеспечения транзакционной репликации;
  - модуль обмена транзакционными репликами с другими серверами кластера;
  - набор базовых модулей для создания серверов приёма телематических данных с IoT (реализация через NIO.2);
  - компонент для работы с S3-подобными храниилищами (MinIO);

### core_server_mvc

Базовый web-контейнер, использующий для работы технологию Spring Boot MVC и содержащий следующие модули:
  - базовое Spring MVC-приложение;
  - основной Spring MVC-контроллер приложения;
  - контроллер для загрузки/выгрузки файлов (использует файловую систему или S3-хранилище);
  - контроллер поддержки транзакционной репликации;
  - контроллер для работы с аккаунтами пользователей;
  - набор базовых JPA сущностей и репозиториев;

### core_server_flux

Базовый web-контейнер, использующий для работы технологию Spring Boot WebFlux.
В данный момент находится в разработке.

### mms: core, compose_web, server, server_mvc

Группа прикладных модулей, реализующих проект [Система контроля транспорта и технологических объектов "Пульсар"](https://pulsar.report):
  - core: содержит mms-специфичные common-модули, аналогичные базовому common-модулю; 
  - web: содержит mms-специфичную настройку цветовой схемы клиентской части и элементы особого дизайна;
  - server: содержит модули бизнес-логики прикладной части системы:
    - модули расчёта пробегов, работы оборудования, расхода топлива, генерации электроэнергии;
    - модули работы со списком приборов/контроллеров различных типов;
    - модули конфигурации различных датчиков, с возможностью задания параметров сглаживания и тарировки:
      - датчиков GPS/ГЛОНАСС;
      - работы оборудования;
      - показаний с электрических счётчиков;
      - датчиков уровня топлива (с дополнительым заданием параметров детекторов заправки и слива);
      - различных аналоговых величин;
      - сигнальных датчиков;
    - классы-обработчики протоколов приборов/контроллеров различных типов (с реализацией через NIO.2):
      - [Galileo](https://7gis.ru)
      - устаревшие и переставшие поддерживаться: ADM, Arnavi, Galileo Iridium, Mielta, Wialon IPS;
    - модули подготовки данных для отображения и изменения прикладной гео-информации на картограческой подложке (точечные и текстовые объекты, векторные геозоны);
    - модули подготовки данных для отображения состояния объектов в SCADA-подобном виде; 
    - модули подготовки данных для графиков измерений:
      - сложных графиков уровня топлива с отображением:
        - периодов заправки и слива;
        - работы оборудования;
        - местонахождения в геозонах (для передвижных объектов);
      - аналоговых датчиков:
        - уровня топлива;
        - веса;
        - оборотов вращения;
        - давления;
        - температуры;
        - мощности;
        - плотности;
        - массового и объёмного потока;
        - электрических параметров (пофазно):
          - напряжения;
          - тока;
          - коэффициента мощности;
          - активной, реактивной и суммарной мощности;
      - графиков скоростного режима;
    - модули генерации различных отчётов;
    - модули поддержки различных справочников (в т.ч. объектов, геозон);
    - модули подготовки данных для отображения различных журналов работ (посуточных, посменных, по путевым листам);
    - сервисные модули:
      - автоматического удаления устаревших телематических данных;
      - мониторинга объектов (потеря связи, отсутствие данных и т.п.);
    - модули поддержки систем видеонаблюдения (устарело и отключено, требует переработки);
  - server_mvc: прикладной web-контейнер, использующий для работы технологию Spring Boot MVC и содержащий следующие модули:
    - Spring MVC-приложение;
    - Spring MVC-контроллер;
    - набор прикладных mms-специфичных JPA сущностей и репозиториев;

### office: core, compose_web, server, server_mvc

Группа прикладных модулей, реализующих проект [Система контроля исполнения поручений](http://crm.magnol.ru)

(находится в процессе документирования...)

### shop: core, compose_web, server, server_mvc

Группа прикладных модулей, реализующих проект "Система розничной торговли и складского учёта"

(находится в процессе документирования...)

### ts: core, compose_web, server, server_mvc

Группа прикладных модулей, реализующих проект "Система контроля установок депарафинизации скважин "УДС-Техно"

(находится в процессе документирования...)

## Техническая часть

Исходный код написан на Kotlin и организован в виде gradle-проекта (Kotlin Multiplatform). 
